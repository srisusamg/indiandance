<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>üéÆ Bollywood Beat Master - Pro Gamer Edition üèÜ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Russo+One&family=Poppins:wght@400;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(45deg, #1e1e1e, #2d3436, #1a1a1a);
            background-size: 300% 300%;
            animation: gamingGradient 10s ease infinite;
            overflow: hidden;
            height: 100vh;
            height: 100dvh; /* Dynamic viewport height for mobile */
            user-select: none;
            touch-action: manipulation;
            position: relative;
            /* Mobile Safari bottom bar fix */
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        .theme-holi { background: linear-gradient(45deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3, #54a0ff); }
        .theme-diwali { background: linear-gradient(45deg, #ff9500, #ff6b00, #ffdd00, #ff4757, #ffa502); }
        .theme-wedding { background: linear-gradient(45deg, #ff6b9d, #c44569, #f8b500, #ff6348, #ff9ff3); }
        .theme-club { background: linear-gradient(45deg, #1e3c72, #2a5298, #ff6b6b, #feca57, #ee5a24); }
        .theme-gaming { background: linear-gradient(45deg, #0d0d0d, #1a1a1a, #2a2a2a, #1e1e1e); }
        
        @keyframes gamingGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .disco-lights {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            opacity: 0.7;
        }
        
        .disco-ball {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: radial-gradient(circle, #444, #111);
            animation: discoBallSpin 5s linear infinite;
            z-index: 5;
            box-shadow: 0 0 20px #000;
        }
        
        @keyframes discoBallSpin {
            0% { transform: translateX(-50%) rotate(0deg); }
            100% { transform: translateX(-50%) rotate(360deg); }
        }
        
        .spotlight {
            position: absolute;
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1), transparent);
            animation: spotlightMove 8s ease-in-out infinite;
            pointer-events: none;
        }
        
        @keyframes spotlightMove {
            0%, 100% { transform: translate(0, 0); }
            25% { transform: translate(200px, 150px); }
            50% { transform: translate(-150px, 300px); }
            75% { transform: translate(300px, -50px); }
        }
        
        .light {
            position: absolute;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            animation: discoFlash 2s ease-in-out infinite;
        }
        
        @keyframes discoFlash {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.5); }
        }
        
        .container {
            position: relative;
            z-index: 10;
            text-align: center;
            padding: 15px;
            height: 100vh;
            height: 100dvh; /* Dynamic viewport height for mobile */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            /* Mobile Safari safe area */
            padding-top: max(15px, env(safe-area-inset-top));
            padding-bottom: max(15px, env(safe-area-inset-bottom));
        }
        
        .header {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            margin-bottom: 15px;
        }
        
        .title {
            font-family: 'Russo One', sans-serif;
            font-size: 2.2em;
            font-weight: 700;
            color: #00a8ff;
            text-shadow: 0 0 10px #00a8ff, 0 0 20px #00a8ff;
            margin-bottom: 10px;
        }
        
        .score-board {
            display: flex;
            justify-content: space-around;
            font-size: 1.1em;
            color: #eee;
            font-weight: 600;
        }
        
        .game-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            perspective: 800px;
        }
        
        .dancer {
            width: 200px;
            height: 200px;
            margin: 20px;
            transition: all 0.3s ease;
            filter: drop-shadow(0 0 20px rgba(0, 168, 255, 0.6));
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            position: relative;
            transform-style: preserve-3d;
        }
        
        .dancer.thumka {
            animation: thumkaShake 0.5s ease-in-out;
        }
        
        .dancer.bhangra {
            animation: bhangraMove 0.6s ease-in-out;
        }
        
        .dancer.handwave {
            animation: handWave 0.5s ease-in-out;
        }
        
        .dancer.headbob {
            animation: headBob 0.4s ease-in-out;
        }
        
        .dancer.dandiya {
            animation: dandiyaMove 0.7s ease-in-out;
        }
        
        @keyframes thumkaShake {
            0%, 100% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(-5deg) scale(1.1) translateX(-10px); }
            75% { transform: rotate(5deg) scale(1.1) translateX(10px); }
        }
        
        @keyframes bhangraMove {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-20px) rotate(10deg) scale(1.1); }
            50% { transform: translateY(0) rotate(-10deg) scale(1.2); }
            75% { transform: translateY(-15px) rotate(5deg) scale(1.1); }
        }
        
        @keyframes handWave {
            0%, 100% { transform: rotateZ(0deg) rotateY(0deg); }
            25% { transform: rotateZ(15deg) rotateY(20deg) scale(1.1); }
            50% { transform: rotateZ(-15deg) rotateY(-20deg) scale(1.2); }
            75% { transform: rotateZ(10deg) rotateY(15deg) scale(1.1); }
        }
        
        @keyframes headBob {
            0%, 100% { transform: translateY(0) rotateX(0deg); }
            33% { transform: translateY(-10px) rotateX(10deg) scale(1.05); }
            66% { transform: translateY(5px) rotateX(-5deg) scale(1.1); }
        }
        
        @keyframes dandiyaMove {
            0%, 100% { transform: rotate(0deg) scale(1); }
            20% { transform: rotate(45deg) translateX(15px) scale(1.1); }
            40% { transform: rotate(-45deg) translateX(-15px) scale(1.2); }
            60% { transform: rotate(30deg) translateY(-10px) scale(1.15); }
            80% { transform: rotate(-30deg) translateY(10px) scale(1.1); }
        }
        
        .tap-cue {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Russo One', sans-serif;
            font-size: 2em;
            font-weight: 700;
            background: linear-gradient(45deg, #00a8ff, #00ffc6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            opacity: 0;
            animation: tapCueFlash 0.5s ease-in-out;
            pointer-events: none;
            text-shadow: 0 0 10px rgba(0, 255, 198, 0.5);
        }
        
        @keyframes tapCueFlash {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
        }
        
        .feedback {
            font-size: 2em;
            font-weight: 700;
            margin: 20px 0;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Russo One', sans-serif;
        }
        
        .combo-meter {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 15px;
            border-radius: 15px;
            font-weight: 700;
            font-size: 1.2em;
            color: #00a8ff;
            display: none;
            border: 1px solid rgba(0, 168, 255, 0.5);
            text-shadow: 0 0 5px #00a8ff;
        }
        
        .combo-animation {
            animation: comboFlash 0.5s ease-in-out;
        }
        
        @keyframes comboFlash {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); color: #00ffc6; }
        }
        
        .power-up {
            position: absolute;
            font-size: 2em;
            background: radial-gradient(circle, #feca57, #ff6b6b);
            padding: 15px;
            border-radius: 50%;
            animation: powerUpFloat 2s ease-in-out infinite;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 0 20px #feca57;
        }
        
        @keyframes powerUpFloat {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-10px) scale(1.1); }
        }
        
        .leaderboard {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.4);
            z-index: 1000;
            display: none;
            min-width: 320px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .leaderboard h3 {
            color: #00a8ff;
            margin-bottom: 15px;
            font-size: 1.8em;
            font-family: 'Russo One', sans-serif;
            text-shadow: 0 0 10px #00a8ff;
        }
        
        .score-entry {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 8px 12px;
            border-radius: 10px;
            background: rgba(0, 168, 255, 0.1);
            color: #eee;
            font-weight: 600;
        }
        
        .difficulty-selector {
            margin: 15px 0;
        }
        
        .difficulty-btn {
            background: linear-gradient(45deg, #333, #555);
            color: white;
            border: 1px solid #777;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 20px;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        
        .difficulty-btn:hover {
            background: linear-gradient(45deg, #444, #666);
            border-color: #999;
        }
        
        .difficulty-btn.active {
            background: linear-gradient(45deg, #00a8ff, #00ffc6);
            transform: scale(1.05);
            color: #111;
            border: none;
            text-shadow: none;
        }
        
        .perfect { color: #00ffc6; text-shadow: 0 0 8px rgba(0, 255, 198, 0.7); }
        .good { color: #feca57; text-shadow: 0 0 8px rgba(254, 202, 87, 0.7); }
        .missed { color: #ff6b6b; text-shadow: 0 0 8px rgba(255, 107, 107, 0.7); }
        
        .controls {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 20px 20px 0 0;
            box-shadow: 0 -8px 32px rgba(0, 0, 0, 0.3);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .tap-button {
            background: radial-gradient(circle, #00a8ff, #007bff);
            border: none;
            border-radius: 50%;
            width: 120px;
            height: 120px;
            font-size: 2em;
            color: white;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 0 20px #00a8ff, inset 0 0 10px rgba(255,255,255,0.3);
            font-family: 'Russo One', sans-serif;
            text-shadow: 0 0 5px rgba(0,0,0,0.5);
        }
        
        .tap-button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px #00a8ff, 0 0 40px #00ffc6, inset 0 0 10px rgba(255,255,255,0.3);
        }
        
        .tap-button:active {
            transform: scale(0.95);
        }
        
        .start-button {
            background: linear-gradient(45deg, #00a8ff, #00ffc6);
            color: #111;
            border: none;
            padding: 15px 30px;
            border-radius: 30px;
            font-size: 1.5em;
            font-weight: 600;
            cursor: pointer;
            margin: 10px;
            transition: all 0.2s ease;
            font-family: 'Russo One', sans-serif;
            text-shadow: none;
        }
        
        .start-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 168, 255, 0.3);
        }
        
        .confetti {
            position: absolute;
            pointer-events: none;
            z-index: 100;
        }
        
        .confetti-piece {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #00a8ff;
            animation: confettiFall 2s ease-out forwards;
        }
        
        @keyframes confettiFall {
            0% {
                opacity: 1;
                transform: translateY(0) rotate(0deg);
            }
            100% {
                opacity: 0;
                transform: translateY(300px) rotate(360deg);
            }
        }
        
        .celebration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 30px;
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.4);
            z-index: 1000;
            text-align: center;
            font-size: 2em;
            color: #00a8ff;
            display: none;
            border: 1px solid rgba(0, 168, 255, 0.5);
        }
        
        .game-status {
            font-size: 1.2em;
            color: #ccc;
            margin: 10px 0;
            font-weight: 600;
        }
        
        @media (max-width: 768px) {
            .title { font-size: 1.8em; }
            .dancer { font-size: 80px; width: 150px; height: 150px; }
            .tap-button { width: 100px; height: 100px; font-size: 1.5em; }
            .score-board { font-size: 1em; }
            .feedback { font-size: 1.5em; }
            
            /* Mobile Safari specific fixes */
            .container {
                height: 100dvh; /* Dynamic viewport height */
                padding-bottom: max(20px, env(safe-area-inset-bottom) + 20px);
            }
            
            .controls {
                padding: 15px;
                margin-bottom: env(safe-area-inset-bottom);
            }
            
            /* Ensure controls are always visible above Safari bottom bar */
            .controls {
                position: relative;
                z-index: 100;
                background: rgba(0, 0, 0, 0.75);
                backdrop-filter: blur(10px);
                border-radius: 20px 20px 0 0;
                box-shadow: 0 -8px 32px rgba(0, 0, 0, 0.3);
            }
            
            /* Better touch targets for mobile */
            .tap-button, .start-button, .difficulty-btn {
                min-height: 44px; /* iOS recommended touch target */
                min-width: 44px;
            }
        }
        
        .audio-control {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.5em;
            cursor: pointer;
            z-index: 100;
            color: white;
        }
    </style>
</head>
<body class="theme-gaming">
    <div class="disco-lights" id="discoLights"></div>
    <div class="disco-ball"></div>
    <div class="spotlight"></div>
    
    <div class="combo-meter" id="comboMeter">
        Combo: <span id="combo">0</span>x
    </div>
    
    <div class="container">
        <div class="header">
            <div class="title">üèÜ Bollywood Beat Master üèÜ</div>
            <div class="score-board">
                <div>Score: <span id="score">0</span></div>
                <div>Round: <span id="round">0</span>/<span id="maxRounds">10</span></div>
                <div>Best: <span id="bestTime">0</span>ms</div>
            </div>
        </div>
        
        <div class="game-area">
            <div class="dancer" id="dancer"></div>
            <div class="tap-cue" id="tapCue">üí• TAP NOW üí•</div>
            <div class="feedback" id="feedback"></div>
            <div class="game-status" id="gameStatus">Choose difficulty to start your rhythm gaming adventure!</div>
        </div>
        
        <div class="controls">
            <div class="difficulty-selector" id="difficultySelector">
                <button class="difficulty-btn active" onclick="selectDifficulty('easy')">üòé Novice</button>
                <button class="difficulty-btn" onclick="selectDifficulty('normal')">üî• Pro</button>
                <button class="difficulty-btn" onclick="selectDifficulty('hard')">‚ö° Elite</button>
                <button class="difficulty-btn" onclick="selectDifficulty('endless')">üíé Legend</button>
            </div>
            <button class="start-button" id="startButton" onclick="startGame()">üé¨ Start Game</button>
            <button class="tap-button" id="tapButton" onclick="handleTap()" disabled>TAP!</button>
            <button class="start-button" onclick="showLeaderboard()" style="font-size: 1em; padding: 10px 20px;">üèÜ Scores</button>
        </div>
    </div>
    
    <div class="celebration" id="celebration">
        <div id="celebrationTitle">üéâ You're a Rhythm Master! üéâ</div>
        <div style="font-size: 0.6em; margin-top: 20px;">
            Final Score: <span id="finalScore">0</span><br>
            Perfect Hits: <span id="perfectHits">0</span><br>
            Max Combo: <span id="maxComboDisplay">0</span>x
        </div>
        <div style="margin-top: 20px;">
            <input type="text" id="playerName" placeholder="Enter your name" maxlength="10" style="padding: 10px; border-radius: 10px; border: 2px solid #00a8ff; margin-right: 10px; background: #333; color: white;">
            <button class="start-button" onclick="saveScore()">üíæ Save Score</button>
        </div>
        <button class="start-button" onclick="resetGame()" style="margin-top: 10px;">üîÑ Play Again</button>
    </div>
    
    <div class="leaderboard" id="leaderboard">
        <h3>üèÜ Gaming Champions üèÜ</h3>
        <div id="leaderboardList"></div>
        <button class="start-button" onclick="hideLeaderboard()" style="margin-top: 15px;">‚úñÔ∏è Close</button>
    </div>
    
    <button class="audio-control" id="audioControl" onclick="toggleAudio()">üéµ</button>
    
    <!-- High-Quality Bollywood Music Tracks from Pixabay -->
    <audio id="bgMusic1" loop preload="auto" src="https://cdn.pixabay.com/audio/2022/01/21/audio_3118dd7452.mp3"></audio>
    <audio id="bgMusic2" loop preload="auto" src="https://cdn.pixabay.com/audio/2023/05/18/audio_3353f371f0.mp3"></audio>
    <audio id="bgMusic3" loop preload="auto" src="https://cdn.pixabay.com/audio/2022/05/23/audio_988958a683.mp3"></audio>
    <audio id="bgMusic4" loop preload="auto" src="https://cdn.pixabay.com/audio/2022/03/10/audio_73d8699f3b.mp3"></audio>
    <audio id="bgMusic5" loop preload="auto" src="https://cdn.pixabay.com/audio/2021/11/23/audio_85149e33b2.mp3"></audio>
    
    <!-- High-Quality Sound Effects from Pixabay -->
    <audio id="perfectSound" preload="auto" src="https://cdn.pixabay.com/audio/2022/03/15/audio_73ed55159a.mp3"></audio>
    <audio id="goodSound" preload="auto" src="https://cdn.pixabay.com/audio/2021/08/04/audio_bb630cc098.mp3"></audio>
    <audio id="missSound" preload="auto" src="https://cdn.pixabay.com/audio/2022/03/10/audio_e08735367a.mp3"></audio>
    <audio id="comboSound" preload="auto" src="https://cdn.pixabay.com/audio/2022/11/21/audio_a25f131059.mp3"></audio>
    <audio id="powerupSound" preload="auto" src="https://cdn.pixabay.com/audio/2022/05/06/audio_b87e38170c.mp3"></audio>
    <audio id="celebrationSound" preload="auto" src="https://cdn.pixabay.com/audio/2022/08/23/audio_8697811a13.mp3"></audio>
    
    <script>
        // Enhanced Game State with all new features
        let gameState = {
            isPlaying: false,
            score: 0,
            round: 0,
            maxRounds: 10,
            bestTime: Infinity,
            thumkaStartTime: 0,
            waitingForTap: false,
            combo: 0,
            maxCombo: 0,
            perfectHits: 0,
            currentTheme: 4, // Start with gaming theme
            difficulty: 'easy',
            powerUps: [],
            activePowerUp: null,
            currentMusic: 0,
            
            // Enhanced dancers with animated GIFs for a pro-gamer feel
            dancers: [
                'https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExb3Y2a2NqZzZwc3JqZzZpZ3NqZzZqZzZqZzZqZzZqZzZx/l3vR7aXoH6C2AdBvO/giphy.gif',
                'https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExb3Y2a2NqZzZwc3JqZzZpZ3NqZzZqZzZqZzZqZzZqZzZx/xT0xezOCwbeQ6S2h2w/giphy.gif',
                'https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExb3Y2a2NqZzZwc3JqZzZpZ3NqZzZqZzZqZzZqZzZqZzZx/3o7TKUMp3dGz535MvK/giphy.gif',
                'https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExb3Y2a2NqZzZwc3JqZzZpZ3NqZzZqZzZqZzZqZzZqZzZx/3o6ZtqNbtk2S2g3yA8/giphy.gif',
                'https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExb3Y2a2NqZzZwc3JqZzZpZ3NqZzZqZzZqZzZqZzZqZzZx/l2Spitchc6g3iAI2A/giphy.gif'
            ],
            currentDancer: 0,
            
            // Gaming-focused dance moves with professional appeal
            danceMoves: [
                { name: 'Power Strike', emoji: 'üéØ', cue: 'PRECISION STRIKE!', animation: 'thumka', description: 'Perfect timing challenge' },
                { name: 'Lightning Combo', emoji: '‚ö°', cue: 'LIGHTNING FAST!', animation: 'bhangra', description: 'Speed combo move' },
                { name: 'Victory Wave', emoji: 'üèÜ', cue: 'CHAMPION MOVE!', animation: 'handwave', description: 'Triumphant gesture' },
                { name: 'Beat Drop', emoji: 'üî•', cue: 'DROP THE BEAT!', animation: 'headbob', description: 'Rhythm mastery' },
                { name: 'Epic Spin', emoji: 'üí´', cue: 'EPIC COMBO!', animation: 'dandiya', description: 'Advanced rotation' },
                { name: 'Power Burst', emoji: 'üí•', cue: 'POWER BURST!', animation: 'thumka', description: 'Explosive movement' },
                { name: 'Master Flow', emoji: 'üíé', cue: 'MASTER LEVEL!', animation: 'handwave', description: 'Elite technique' }
            ],
            currentMove: 0,
            
            // Background themes
            themes: ['theme-holi', 'theme-diwali', 'theme-wedding', 'theme-club', 'theme-gaming'],
            
            // Voice clips for feedback - Gaming with Bollywood flair
            voiceClips: [
                'Epic Win!', 'Perfect Strike!', 'Godlike!', 'Flawless!',
                'Outstanding!', 'You\'re on Fire!', 'Elite!',
                'Insane Combo!', 'Beast Mode!', 'Flawless Victory!', 'Champion Performance!',
                'Godlike Skills!', 'Unstoppable Force!', 'Elite Gamer!',
                'Maximum Power!', 'Victory Royale!', 'Crushing It!'
            ]
        };
        
        let gameInterval;
        let audioEnabled = false; // Start with audio disabled until user interaction
        let currentBGMusic = null;
        
        // Difficulty settings
        const difficultySettings = {
            easy: { rounds: 10, minDelay: 2500, maxDelay: 4000, perfectWindow: 150, goodWindow: 300 },
            normal: { rounds: 15, minDelay: 1800, maxDelay: 3500, perfectWindow: 120, goodWindow: 250 },
            hard: { rounds: 20, minDelay: 1200, maxDelay: 2800, perfectWindow: 100, goodWindow: 200 },
            endless: { rounds: Infinity, minDelay: 1000, maxDelay: 2500, perfectWindow: 80, goodWindow: 180 }
        };
        
        // Initialize enhanced disco lights with realistic effects
        function createDiscoLights() {
            const discoContainer = document.getElementById('discoLights');
            const colors = ['#00a8ff', '#00ffc6', '#feca57', '#ff6b6b', '#ff9ff3', '#fd79a8'];
            
            // Create more disco lights
            for (let i = 0; i < 20; i++) {
                const light = document.createElement('div');
                light.className = 'light';
                light.style.left = Math.random() * 100 + '%';
                light.style.top = Math.random() * 100 + '%';
                light.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                light.style.animationDelay = Math.random() * 2 + 's';
                light.style.width = (Math.random() * 10 + 5) + 'px';
                light.style.height = light.style.width;
                discoContainer.appendChild(light);
            }
            
            // Add moving spotlights
            for (let i = 0; i < 2; i++) {
                const spotlight = document.createElement('div');
                spotlight.className = 'spotlight';
                spotlight.style.animationDelay = i * 2 + 's';
                spotlight.style.animationDuration = (8 + i * 2) + 's';
                discoContainer.appendChild(spotlight);
            }
        }
        
        // Enhanced theme switching
        function switchTheme() {
            gameState.currentTheme = (gameState.currentTheme + 1) % gameState.themes.length;
            document.body.className = gameState.themes[gameState.currentTheme];
        }
        
        // Power-up system
        function createPowerUp() {
            if (Math.random() < 0.15 && gameState.isPlaying) { // 15% chance
                const powerUp = document.createElement('div');
                powerUp.className = 'power-up';
                powerUp.innerHTML = ['‚ö°Ô∏è', '2x', '‚ùÑÔ∏è', 'üíé'][Math.floor(Math.random() * 4)];
                powerUp.style.left = Math.random() * 80 + 10 + '%';
                powerUp.style.top = Math.random() * 60 + 20 + '%';
                
                const powerType = ['combo', 'double', 'slow', 'perfect'][Math.floor(Math.random() * 4)];
                powerUp.dataset.type = powerType;
                
                powerUp.onclick = (e) => {
                    e.stopPropagation(); // Prevent tap from registering as a game tap
                    activatePowerUp(powerType, powerUp);
                };
                
                document.querySelector('.game-area').appendChild(powerUp);
                
                // Remove after 5 seconds if not clicked
                setTimeout(() => {
                    if (powerUp.parentNode) {
                        powerUp.remove();
                    }
                }, 5000);
            }
        }
        
        function activatePowerUp(type, element) {
            gameState.activePowerUp = { type, duration: 5000, startTime: Date.now() };
            element.remove();
            
            // Visual feedback
            showFeedback(`Power-Up: ${type.toUpperCase()}!`, 'perfect');
            playSound('powerupSound');
        }
        
        // Enhanced display with combo meter
        function updateDisplay() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('round').textContent = gameState.round;
            document.getElementById('maxRounds').textContent = 
                gameState.difficulty === 'endless' ? '‚àû' : difficultySettings[gameState.difficulty].rounds;
            document.getElementById('bestTime').textContent = 
                gameState.bestTime === Infinity ? '0' : Math.round(gameState.bestTime);
            
            // Update combo meter
            const comboMeter = document.getElementById('comboMeter');
            const comboDisplay = document.getElementById('combo');
            if (gameState.combo > 1) {
                comboMeter.style.display = 'block';
                comboDisplay.textContent = gameState.combo;
                if (gameState.combo > gameState.maxCombo) {
                    gameState.maxCombo = gameState.combo;
                }
                if (gameState.combo % 5 === 0) {
                    comboMeter.classList.add('combo-animation');
                    setTimeout(() => comboMeter.classList.remove('combo-animation'), 500);
                }
            } else {
                comboMeter.style.display = 'none';
            }
        }
        
        // Difficulty selection
        function selectDifficulty(difficulty) {
            gameState.difficulty = difficulty;
            
            // Update UI
            document.querySelectorAll('.difficulty-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('gameStatus').textContent = 
                `${difficulty.charAt(0).toUpperCase() + difficulty.slice(1)} mode selected! Press Start!`;
        }
        
        // Enhanced music system with authentic Bollywood tracks
        function playBackgroundMusic() {
            if (!audioEnabled) return;
            
            if (currentBGMusic) {
                currentBGMusic.pause();
            }
            
            const musicTracks = ['bgMusic1', 'bgMusic2', 'bgMusic3', 'bgMusic4', 'bgMusic5'];
            gameState.currentMusic = (gameState.currentMusic + 1) % musicTracks.length;
            currentBGMusic = document.getElementById(musicTracks[gameState.currentMusic]);
            
            // Set volume for better experience
            currentBGMusic.volume = 0.4;
            const playPromise = currentBGMusic.play();
            if (playPromise !== undefined) {
                playPromise.catch(e => {
                    console.log('Audio play failed:', e);
                    // Audio will be enabled on first user tap
                });
            }
        }
        
        // Enable audio on first user interaction (required for mobile)
        function enableAudio() {
            if (audioEnabled) return;
            audioEnabled = true;
            document.getElementById('audioControl').textContent = 'üéµ';
            // Pre-play and pause all sounds to ensure they are loaded on iOS
            document.querySelectorAll('audio').forEach(audio => {
                audio.play().then(() => audio.pause()).catch(() => {});
            });
            playBackgroundMusic();
        }
        
        function playSound(soundId) {
            if (!audioEnabled) return;
            const sound = document.getElementById(soundId);
            if (sound) {
                sound.currentTime = 0;
                sound.volume = 0.6;
                sound.play().catch(e => console.log('Sound play failed:', e));
            }
        }
        
        // Voice feedback system with enhanced gaming expressions
        function playVoiceClip(type) {
            if (!audioEnabled) return;
            
            let clips;
            switch(type) {
                case 'perfect':
                    clips = ['Epic Win!', 'Perfect Strike!', 'Godlike!', 'Flawless!'];
                    break;
                case 'good':
                    clips = ['Outstanding!', 'You\'re on Fire!', 'Elite!'];
                    break;
                case 'miss':
                    clips = ['Oof!', 'Almost!', 'Next time!'];
                    break;
                case 'combo':
                    clips = ['Insane Combo!', 'Beast Mode!', 'Unstoppable!', 'Victory Royale!'];
                    break;
                case 'victory':
                    clips = ['Legendary Performance!', 'You are the Beat Master!', 'GG! Well Played!'];
                    break;
                default:
                    clips = gameState.voiceClips;
            }
            
            const clip = clips[Math.floor(Math.random() * clips.length)];
            
            // Create a speech synthesis for Bollywood phrases
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(clip);
                utterance.rate = 1.2;
                utterance.pitch = 1.3;
                utterance.volume = 0.8;
                utterance.lang = 'en-IN'; // Indian English accent
                speechSynthesis.speak(utterance);
            }
            
            // Also play celebration sound for perfect hits
            if (type === 'perfect') {
                setTimeout(() => playSound('celebrationSound'), 300);
            }
        }
        
        function startGame() {
            enableAudio(); // Ensure audio is enabled when the game starts
            gameState.isPlaying = true;
            gameState.score = 0;
            gameState.round = 0;
            gameState.combo = 0;
            gameState.maxCombo = 0;
            gameState.perfectHits = 0;
            gameState.bestTime = Infinity;
            gameState.maxRounds = difficultySettings[gameState.difficulty].rounds;
            
            document.getElementById('startButton').style.display = 'none';
            document.getElementById('difficultySelector').style.display = 'none';
            document.getElementById('tapButton').disabled = false;
            document.getElementById('gameStatus').textContent = 'Get ready for the first move!';
            document.getElementById('feedback').textContent = '';
            
            playBackgroundMusic();
            updateDisplay();
            
            // Set initial dancer
            const dancer = document.getElementById('dancer');
            dancer.style.backgroundImage = `url(${gameState.dancers[0]})`;
            
            scheduleNextMove();
        }
        
        function scheduleNextMove() {
            if (gameState.round >= gameState.maxRounds && gameState.difficulty !== 'endless') {
                endGame();
                return;
            }
            
            const settings = difficultySettings[gameState.difficulty];
            let delay = Math.random() * (settings.maxDelay - settings.minDelay) + settings.minDelay;
            
            // In endless mode, speed up over time
            if (gameState.difficulty === 'endless') {
                delay *= Math.max(0.4, 1 - (gameState.round / 100)); // Speed up to 60% faster
            }

            setTimeout(() => {
                if (gameState.isPlaying) {
                    performDanceMove();
                }
            }, delay);
        }
        
        function performDanceMove() {
            gameState.round++;
            gameState.waitingForTap = true;
            gameState.thumkaStartTime = Date.now();
            
            // Select random dance move
            gameState.currentMove = Math.floor(Math.random() * gameState.danceMoves.length);
            const move = gameState.danceMoves[gameState.currentMove];
            
            // Change dancer occasionally with animated GIFs
            if (Math.random() < 0.3) {
                gameState.currentDancer = (gameState.currentDancer + 1) % gameState.dancers.length;
                const dancer = document.getElementById('dancer');
                dancer.style.backgroundImage = `url(${gameState.dancers[gameState.currentDancer]})`;
            }
            
            // Animate dancer with specific move
            const dancer = document.getElementById('dancer');
            dancer.classList.add(move.animation);
            
            // Show move-specific cue with description
            const tapCue = document.getElementById('tapCue');
            tapCue.innerHTML = `${move.emoji} ${move.cue} ${move.emoji}`;
            
            // Enhanced screen flash with color
            document.body.style.filter = 'brightness(1.4) saturate(1.3)';
            setTimeout(() => {
                tapCue.style.animation = 'tapCueFlash 0.5s ease-in-out';
                tapCue.style.opacity = '1';
            }, 50);
            setTimeout(() => {
                document.body.style.filter = 'brightness(1) saturate(1)';
                tapCue.style.opacity = '0';
            }, 200);
            
            document.getElementById('gameStatus').textContent = 
                `Round ${gameState.round} - ${move.description}!`;
            
            // Create power-up occasionally
            createPowerUp();
            
            // Theme change every 10 rounds
            if (gameState.round % 10 === 0) {
                switchTheme();
            }
            
            // Auto-miss after adjusted time based on difficulty
            const missTimeout = difficultySettings[gameState.difficulty].goodWindow + 200;
            
            setTimeout(() => {
                if (gameState.waitingForTap) {
                    handleMiss();
                }
            }, missTimeout);
            
            // Remove animation
            setTimeout(() => {
                dancer.classList.remove(move.animation);
            }, 700);
        }
        
        function handleTap() {
            if (!gameState.isPlaying || !gameState.waitingForTap) {
                return;
            }
            
            if ('vibrate' in navigator) {
                navigator.vibrate(50); // Haptic feedback
            }

            const reactionTime = Date.now() - gameState.thumkaStartTime;
            gameState.waitingForTap = false;
            
            const settings = difficultySettings[gameState.difficulty];
            let feedback, className, points, isGoodHit = false;
            
            // Apply power-up effects
            let adjustedPerfectWindow = settings.perfectWindow;
            let adjustedGoodWindow = settings.goodWindow;
            let pointMultiplier = 1;
            
            if (gameState.activePowerUp) {
                const powerUp = gameState.activePowerUp;
                const elapsed = Date.now() - powerUp.startTime;
                
                if (elapsed < powerUp.duration) {
                    switch (powerUp.type) {
                        case 'slow':
                            adjustedPerfectWindow *= 1.5;
                            adjustedGoodWindow *= 1.5;
                            break;
                        case 'double':
                            pointMultiplier = 2;
                            break;
                        case 'perfect':
                            if (reactionTime <= adjustedGoodWindow) {
                                reactionTime = adjustedPerfectWindow - 10; // Force perfect
                            }
                            break;
                        case 'combo':
                            gameState.combo += 5; // Instant combo boost
                            break;
                    }
                } else {
                    gameState.activePowerUp = null;
                }
            }
            
            if (reactionTime <= adjustedPerfectWindow) {
                feedback = 'üî• Perfect Strike!';
                className = 'perfect';
                points = 100;
                gameState.perfectHits++;
                gameState.combo++;
                isGoodHit = true;
                playSound('perfectSound');
                playVoiceClip('perfect');
                createEnhancedConfetti('perfect');
            } else if (reactionTime <= adjustedGoodWindow) {
                feedback = 'üéØ Great Hit!';
                className = 'good';
                points = 50;
                gameState.combo++;
                isGoodHit = true;
                playSound('goodSound');
                playVoiceClip('good');
                createEnhancedConfetti('good');
            } else {
                feedback = '‚ùå Missed!';
                className = 'missed';
                points = 0;
                gameState.combo = 0;
                playSound('missSound');
                playVoiceClip('miss');
            }
            
            // Apply combo bonus with Bollywood flair
            if (gameState.combo > 2) {
                const comboBonus = Math.min(100, Math.floor(gameState.combo / 2) * 10);
                points += comboBonus;
                feedback += ` +${comboBonus} Combo!`;
                
                if (gameState.combo % 5 === 0) {
                    playSound('comboSound');
                    playVoiceClip('combo');
                    feedback += ' üî• Streak! üî•';
                }
            }
            
            // Apply power-up multiplier
            points *= pointMultiplier;
            
            if (reactionTime < gameState.bestTime && isGoodHit) {
                gameState.bestTime = reactionTime;
            }
            
            gameState.score += points;
            
            showFeedback(`${feedback} (${reactionTime}ms)`, className);
            updateDisplay();
            
            // Schedule next move
            setTimeout(() => {
                document.getElementById('feedback').textContent = '';
                scheduleNextMove();
            }, 1200);
        }
        
        function showFeedback(text, className) {
            const feedbackElement = document.getElementById('feedback');
            feedbackElement.textContent = text;
            feedbackElement.className = 'feedback ' + className;
        }
        
        function handleMiss() {
            if (!gameState.waitingForTap) return;
            
            gameState.waitingForTap = false;
            gameState.combo = 0;
            
            showFeedback('‚ùå Missed! Too Slow!', 'missed');
            playSound('missSound');
            playVoiceClip('miss');
            updateDisplay();
            
            setTimeout(() => {
                document.getElementById('feedback').textContent = '';
                scheduleNextMove();
            }, 1200);
        }
        
        // Enhanced confetti system
        function createEnhancedConfetti(type) {
            const colors = type === 'perfect' 
                ? ['#00ffc6', '#00a8ff', '#ffffff']
                : ['#feca57', '#ff9ff3', '#ffffff'];
            
            const particleCount = type === 'perfect' ? 40 : 20;
            
            for (let i = 0; i < particleCount; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti-piece';
                confetti.style.left = (Math.random() * 100) + 'vw';
                confetti.style.top = (Math.random() * 100) + 'vh';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 0.2 + 's';
                confetti.style.animationDuration = (1.5 + Math.random() * 1) + 's';
                
                // Add different shapes
                const shape = Math.random();
                if (shape < 0.3) {
                    confetti.style.borderRadius = '50%';
                } else if (shape < 0.6) {
                    confetti.style.width = '5px';
                    confetti.style.height = '15px';
                }
                
                document.body.appendChild(confetti);
                
                setTimeout(() => {
                    confetti.remove();
                }, 2500);
            }
        }
        
        // Leaderboard system with localStorage
        function saveScore() {
            const playerName = document.getElementById('playerName').value.trim() || 'Anonymous';
            const newScore = {
                name: playerName,
                score: gameState.score,
                perfectHits: gameState.perfectHits,
                maxCombo: gameState.maxCombo,
                difficulty: gameState.difficulty,
                date: new Date().toLocaleDateString()
            };
            
            let leaderboard = JSON.parse(localStorage.getItem('bollywoodBeatMasterLeaderboard') || '[]');
            leaderboard.push(newScore);
            leaderboard.sort((a, b) => b.score - a.score);
            leaderboard = leaderboard.slice(0, 10); // Keep top 10
            
            localStorage.setItem('bollywoodBeatMasterLeaderboard', JSON.stringify(leaderboard));
            
            document.getElementById('celebration').style.display = 'none';
            showLeaderboard();
        }
        
        function showLeaderboard() {
            const leaderboard = JSON.parse(localStorage.getItem('bollywoodBeatMasterLeaderboard') || '[]');
            const leaderboardList = document.getElementById('leaderboardList');
            
            if (leaderboard.length === 0) {
                leaderboardList.innerHTML = '<div style="text-align: center; color: #666;">No scores yet!</div>';
            } else {
                leaderboardList.innerHTML = leaderboard.map((score, index) => `
                    <div class="score-entry" style="background: ${index === 0 ? 'rgba(0, 255, 198, 0.2)' : index === 1 ? 'rgba(0, 168, 255, 0.2)' : index === 2 ? 'rgba(254, 202, 87, 0.2)' : 'rgba(0, 168, 255, 0.1)'};">
                        <span>${index + 1}. ${score.name}</span>
                        <span>${score.score} pts (${score.difficulty.slice(0,1).toUpperCase()})</span>
                    </div>
                `).join('');
            }
            
            document.getElementById('leaderboard').style.display = 'block';
        }
        
        function hideLeaderboard() {
            document.getElementById('leaderboard').style.display = 'none';
        }
        
        function endGame() {
            gameState.isPlaying = false;
            document.getElementById('tapButton').disabled = true;
            document.getElementById('gameStatus').textContent = 'Game Over!';
            
            // Stop music
            if (currentBGMusic) {
                currentBGMusic.pause();
            }
            
            // Update celebration text based on performance
            const celebrationTitle = document.getElementById('celebrationTitle');
            const roundsPlayed = gameState.difficulty === 'endless' ? gameState.round : gameState.maxRounds;
            if (gameState.perfectHits >= roundsPlayed * 0.8) {
                celebrationTitle.textContent = 'üëë Gaming Legend! üëë';
            } else if (gameState.perfectHits >= roundsPlayed * 0.6) {
                celebrationTitle.textContent = 'üèÜ Rhythm Master! üèÜ';
            } else if (gameState.perfectHits >= roundsPlayed * 0.4) {
                celebrationTitle.textContent = 'üî• Pro Player! üî•';
            } else {
                celebrationTitle.textContent = 'üëç Keep Gaming! üëç';
            }
            
            // Show enhanced celebration
            document.getElementById('finalScore').textContent = gameState.score;
            document.getElementById('perfectHits').textContent = gameState.perfectHits;
            document.getElementById('maxComboDisplay').textContent = gameState.maxCombo;
            document.getElementById('celebration').style.display = 'block';
            
            // Create massive confetti explosion
            for (let i = 0; i < 100; i++) {
                setTimeout(() => createEnhancedConfetti(i % 3 === 0 ? 'perfect' : 'good'), i * 20);
            }
            
            // Play victory voice clip
            setTimeout(() => playVoiceClip('victory'), 1000);
        }
        
        function resetGame() {
            document.getElementById('celebration').style.display = 'none';
            document.getElementById('startButton').style.display = 'inline-block';
            document.getElementById('difficultySelector').style.display = 'block';
            document.getElementById('feedback').textContent = '';
            document.getElementById('gameStatus').textContent = 'Choose difficulty to start your rhythm gaming adventure!';
            document.getElementById('comboMeter').style.display = 'none';
            
            // Clear power-ups
            document.querySelectorAll('.power-up').forEach(p => p.remove());
            
            gameState.isPlaying = false;
            gameState.score = 0;
            gameState.round = 0;
            gameState.combo = 0;
            gameState.maxCombo = 0;
            gameState.perfectHits = 0;
            gameState.bestTime = Infinity;
            gameState.activePowerUp = null;
            updateDisplay();
        }
        
        function toggleAudio() {
            if (!audioEnabled) {
                enableAudio();
                return;
            }
            audioEnabled = !audioEnabled;
            const audioControl = document.getElementById('audioControl');
            
            if (audioEnabled) {
                audioControl.textContent = 'üéµ';
                if (gameState.isPlaying && currentBGMusic) {
                    currentBGMusic.play().catch(e => console.log('Audio play failed:', e));
                }
            } else {
                audioControl.textContent = 'üîá';
                if (currentBGMusic) {
                    currentBGMusic.pause();
                }
                speechSynthesis.cancel();
            }
        }
        
        // Enhanced touch and keyboard support
        function handleInteraction() {
            if (gameState.isPlaying) {
                handleTap();
            } else if (!document.getElementById('celebration').style.display || 
                      document.getElementById('celebration').style.display === 'none') {
                if (document.getElementById('startButton').style.display !== 'none') {
                    startGame();
                }
            }
        }

        document.getElementById('tapButton').addEventListener('touchstart', function(e) {
            e.preventDefault();
            handleInteraction();
        });
        
        // Multi-key support
        document.addEventListener('keydown', function(e) {
            if (e.code === 'Space' || e.code === 'Enter' || e.code === 'KeyJ' || e.code === 'KeyK') {
                e.preventDefault();
                handleInteraction();
            }
            
            // Theme switching with T key
            if (e.code === 'KeyT' && gameState.isPlaying) {
                switchTheme();
            }
            
            // Music switching with M key
            if (e.code === 'KeyM' && gameState.isPlaying) {
                playBackgroundMusic();
            }
        });
        
        // Initialize the enhanced game with audio preloading
        function initializeGame() {
            createDiscoLights();
            updateDisplay();
            
            document.getElementById('gameStatus').textContent = 
                'Loading Assets...';

            // Preload all audio files
            const audioElements = document.querySelectorAll('audio');
            let loadedCount = 0;
            const totalAssets = audioElements.length + gameState.dancers.length;

            const assetLoaded = () => {
                loadedCount++;
                const percentage = Math.round((loadedCount / totalAssets) * 100);
                document.getElementById('gameStatus').textContent = `Loading Assets... ${percentage}%`;
                if (loadedCount === totalAssets) {
                    document.getElementById('gameStatus').textContent = 
                        'Ready! Choose difficulty to begin!';
                    document.getElementById('startButton').disabled = false;
                }
            };

            audioElements.forEach(audio => {
                audio.addEventListener('canplaythrough', assetLoaded, { once: true });
                audio.load(); // Start loading
            });

            // Preload dancer images
            gameState.dancers.forEach(url => {
                const img = new Image();
                img.onload = assetLoaded;
                img.src = url;
            });
            
            // Initialize default difficulty
            selectDifficulty('easy');
            document.getElementById('startButton').disabled = true;
        }
        
        // Photo mode functionality
        function takeScreenshot() {
            // This would require a library like html2canvas for a real implementation
            showFeedback('üì∏ Photo Mode Activated! (Feature in development)', 'perfect');
        }
        
        // Add screenshot button to celebration
        function addPhotoButton() {
            const celebration = document.getElementById('celebration');
            if (celebration) {
                const photoBtn = document.createElement('button');
                photoBtn.className = 'start-button';
                photoBtn.innerHTML = 'üì∏ Photo Mode';
                photoBtn.onclick = takeScreenshot;
                photoBtn.style.fontSize = '1em';
                photoBtn.style.padding = '10px 20px';
                photoBtn.style.margin = '5px';
                photoBtn.style.background = 'linear-gradient(45deg, #8e44ad, #9b59b6)';
                celebration.appendChild(photoBtn);
            }
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeGame();
            addPhotoButton();
            
            // A single event listener to enable audio context
            const enableAudioListener = () => {
                enableAudio();
                window.removeEventListener('click', enableAudioListener);
                window.removeEventListener('touchstart', enableAudioListener);
                window.removeEventListener('keydown', enableAudioListener);
            };
            window.addEventListener('click', enableAudioListener, { once: true });
            window.addEventListener('touchstart', enableAudioListener, { once: true });
            window.addEventListener('keydown', enableAudioListener, { once: true });
            
            // Prevent zoom on double tap for better mobile experience
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function (event) {
                const now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
        });
    </script>
</body>
</html>
